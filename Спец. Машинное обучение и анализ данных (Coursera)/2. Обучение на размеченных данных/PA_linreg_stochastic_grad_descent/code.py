import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

def write_answer_to_file(answer, filename):
    with open(filename, 'w') as f_out:
        f_out.write(str(round(answer, 3)))

adver_data = pd.read_csv('advertising.csv')
print(adver_data[:5])

adver_data.plot(y='TV', kind='hist')
adver_data.plot(y='Radio', kind='hist')
adver_data.plot(y='Newspaper', kind='hist')
adver_data.plot(y='Sales', kind='hist')
plt.show()

#Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¼Ğ°ÑÑĞ¸Ğ²Ñ‹ NumPy X* Ğ¸Ğ· ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğ¾Ğ² TV, Radio Ğ¸ Newspaper Ğ¸ *y - Ğ¸Ğ· ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğ° Sales. 
X = np.array(adver_data.values[:,0:3])
y = np.array(adver_data.values[:,3])

#ĞÑ‚Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ñ‹ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ X, Ğ²Ñ‹Ñ‡Ñ‚Ñ Ğ¸Ğ· ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ÑÑ€ĞµĞ´Ğ½ĞµĞµ Ğ¿Ğ¾ 
#ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¼Ñƒ ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ñƒ Ğ¸ Ğ¿Ğ¾Ğ´ĞµĞ»Ğ¸Ğ² Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ½Ğ° ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğµ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ.
means, stds = np.mean(X, axis=0), np.std(X, axis=0)
X = (X - means)/stds

#Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğº Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğµ X* ÑÑ‚Ğ¾Ğ»Ğ±ĞµÑ† Ğ¸Ğ· ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†
n = np.shape(X)[0]
ones = np.reshape(np.ones(n),(n,1))
X = np.hstack((X,ones))

#Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞ¹Ñ‚Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ mserror - ÑÑ€ĞµĞ´Ğ½ĞµĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ¸Ñ‡Ğ½ÑƒÑ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ°.
def mserror(y, y_pred):
    return np.mean((y-y_pred)**2)

#ĞšĞ°ĞºĞ¾Ğ²Ğ° ÑÑ€ĞµĞ´Ğ½ĞµĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Sales, ĞµÑĞ»Ğ¸ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ 
#Ğ¼ĞµĞ´Ğ¸Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Sales Ğ¿Ğ¾ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞµ?
y_med = np.median(y)
answer1 = mserror(y,y_med)
print(answer1)
write_answer_to_file(answer1, '1.txt')

#Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞ¹Ñ‚Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ normal_equation, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¿Ğ¾ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ°Ğ¼ (Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ°Ğ¼ NumPy) X* 
#Ğ¸ *y Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ²ĞµÑĞ¾Ğ² ğ‘¤ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ½Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ ÑƒÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ³Ñ€ĞµÑÑĞ¸Ğ¸.
def normal_equation(X, y):
    w = np.linalg.solve(np.dot(X.transpose(), X), np.dot(X.transpose() ,y))
    return w
norm_eq_weights = normal_equation(X, y)
print(norm_eq_weights)

#ĞšĞ°ĞºĞ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒÑ Ñ Ğ²ĞµÑĞ°Ğ¼Ğ¸, Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ 
#Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑƒÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ, Ğ² ÑĞ»ÑƒÑ‡Ğ°Ğµ ÑÑ€ĞµĞ´Ğ½Ğ¸Ñ… Ğ¸Ğ½Ğ²ĞµÑÑ‚Ğ¸Ñ†Ğ¸Ğ¹ Ğ² Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñƒ Ğ¿Ğ¾ Ğ¢Ğ’, Ñ€Ğ°Ğ´Ğ¸Ğ¾ Ğ¸ Ğ² Ğ³Ğ°Ğ·ĞµÑ‚Ğ°Ñ…? 
#(Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸ Ğ½ÑƒĞ»ĞµĞ²Ñ‹Ñ… Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸ÑÑ… Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¾Ğ² TV, Radio Ğ¸ Newspaper). 
answer2 = np.sum([0, 0, 0, 1]*norm_eq_weights)
print(answer2)
write_answer_to_file(answer2, '2.txt')

#ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ linear_prediction, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ğ½Ğ° Ğ²Ñ…Ğ¾Ğ´ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ñƒ X* Ğ¸ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ 
#Ğ²ĞµÑĞ¾Ğ² Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ *w, Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¾Ğ² Ğ² Ğ²Ğ¸Ğ´Ğµ Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ 
#ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğ¾Ğ² Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ X* Ñ Ğ²ĞµÑĞ°Ğ¼Ğ¸ *w.
def linear_prediction(X, w):
	return np.dot(X, w)

#ĞšĞ°ĞºĞ¾Ğ²Ğ° ÑÑ€ĞµĞ´Ğ½ĞµĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Sales Ğ² Ğ²Ğ¸Ğ´Ğµ Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ñ 
#Ğ²ĞµÑĞ°Ğ¼Ğ¸, Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑƒÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ? 
lin = linear_prediction(X, norm_eq_weights)
answer3 = mserror(y, lin)
print(answer3)
write_answer_to_file(answer3, '3.txt')

#ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ stochastic_gradient_step, Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒÑÑ‰ÑƒÑ ÑˆĞ°Ğ³ ÑÑ‚Ğ¾Ñ…Ğ°ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ 
#Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¿ÑƒÑĞºĞ° Ğ´Ğ»Ñ Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ³Ñ€ĞµÑÑĞ¸Ğ¸. Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ñƒ X*, 
#Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ° *y Ğ¸ w*, Ñ‡Ğ¸ÑĞ»Ğ¾ *train_ind - Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ° Ğ¾Ğ±ÑƒÑ‡Ğ°ÑÑ‰ĞµĞ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ¸ (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ X*), 
#Ğ¿Ğ¾ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¼Ñƒ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ²ĞµÑĞ¾Ğ², Ğ° Ñ‚Ğ°ĞºĞ¶Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾ *ğœ‚(eta) - ÑˆĞ°Ğ³ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¿ÑƒÑĞºĞ° 
#(Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ eta=0.01). Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ¼ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ²ĞµÑĞ¾Ğ². 
def stochastic_gradient_step(X, y, w, train_ind, eta=0.01):
    return w + 2 * eta/X.shape[0] * X[train_ind] * (y[train_ind] - linear_prediction(X[train_ind], w))

#ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ stochastic_gradient_descent, Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒÑÑ‰ÑƒÑ ÑÑ‚Ğ¾Ñ…Ğ°ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ½Ñ‹Ğ¹ 
#ÑĞ¿ÑƒÑĞº Ğ´Ğ»Ñ Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ³Ñ€ĞµÑÑĞ¸Ğ¸. Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ğ½Ğ° Ğ²Ñ…Ğ¾Ğ´ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹:
"""
 X - Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ°, ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ°Ñ Ğ¾Ğ±ÑƒÑ‡Ğ°ÑÑ‰ĞµĞ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞµ
 y - Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ°
 w_init - Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ²ĞµÑĞ¾Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
 eta - ÑˆĞ°Ğ³ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¿ÑƒÑĞºĞ° (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 0.01)
 max_iter - Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¿ÑƒÑĞºĞ° (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 10000)
 max_weight_dist - Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ĞµĞ²ĞºĞ»Ğ¸Ğ´Ğ¾Ğ²Ğ¾ Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ°Ğ¼Ğ¸ Ğ²ĞµÑĞ¾Ğ² Ğ½Ğ° ÑĞ¾ÑĞµĞ´Ğ½Ğ¸Ñ… Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸ÑÑ… Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¿ÑƒÑĞºĞ°, Ğ¿Ñ€Ğ¸ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ¿Ñ€ĞµĞºÑ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 1e-8)
 seed - Ñ‡Ğ¸ÑĞ»Ğ¾, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ğ¾Ğµ Ğ´Ğ»Ñ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿ÑĞµĞ²Ğ´Ğ¾ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ñ… Ñ‡Ğ¸ÑĞµĞ» (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 42)
 verbose - Ñ„Ğ»Ğ°Ğ³ Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸, Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ False)
ĞĞ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ² Ğ²ĞµĞºÑ‚Ğ¾Ñ€ (ÑĞ¿Ğ¸ÑĞ¾Ğº) Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒÑÑ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ 
ÑÑ€ĞµĞ´Ğ½ĞµĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ¹ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸. Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°Ñ‚ÑŒ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ²ĞµÑĞ¾Ğ² ğ‘¤, Ğ° Ñ‚Ğ°ĞºĞ¶Ğµ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ 
(ÑĞ¿Ğ¸ÑĞ¾Ğº) Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº."""
def stochastic_gradient_descent(X, y, w_init, eta=1e-2, max_iter=1e4,
								min_weight_dist=1e-8, seed=42, verbose=False):
# Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ°Ğ¼Ğ¸ Ğ²ĞµÑĞ¾Ğ² Ğ½Ğ° ÑĞ¾ÑĞµĞ´Ğ½Ğ¸Ñ…
# Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸ÑÑ… Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼. 
	weight_dist = np.inf
# Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ²ĞµÑĞ¾Ğ²
	w = w_init
# Ğ¡ÑĞ´Ğ° Ğ±ÑƒĞ´ĞµĞ¼ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
	errors = []
# Ğ¡Ñ‡ĞµÑ‚Ñ‡Ğ¸Ğº Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
	iter_num = 0
# Ğ‘ÑƒĞ´ĞµĞ¼ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ´Ğ°Ñ‚ÑŒ Ğ¿ÑĞµĞ²Ğ´Ğ¾ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğµ Ñ‡Ğ¸ÑĞ»Ğ° 
# (Ğ½Ğ¾Ğ¼ĞµÑ€ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ²ĞµÑĞ°), Ğ° Ğ´Ğ»Ñ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
# ÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¿ÑĞµĞ²Ğ´Ğ¾ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ñ… Ñ‡Ğ¸ÑĞµĞ» Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ seed.
	np.random.seed(seed)
# ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ»
	while weight_dist > min_weight_dist and iter_num < max_iter:
	# Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ´Ğ°ĞµĞ¼ Ğ¿ÑĞµĞ²Ğ´Ğ¾ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ 
	# Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ° Ğ¾Ğ±ÑƒÑ‡Ğ°ÑÑ‰ĞµĞ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ¸
		random_ind = np.random.randint(X.shape[0])
		w_new = stochastic_gradient_step(X, y, w, random_ind, eta)
		weight_dist = np.linalg.norm(w-w_new)
		w = w_new
		errors.append(mserror(y, linear_prediction(X, w)))
		iter_num += 1
	return w, errors

#Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ 10^5 Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ ÑÑ‚Ğ¾Ñ…Ğ°ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¿ÑƒÑĞºĞ°. Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… 
#Ğ²ĞµÑĞ¾Ğ² w_init, ÑĞ¾ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ğ¹ Ğ¸Ğ· Ğ½ÑƒĞ»ĞµĞ¹. 
stoch_grad_desc_weights, stoch_errors_by_iter = stochastic_gradient_descent(X, y, np.zeros(X.shape[1]), max_iter=1e5)

#ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ Ğ½Ğ° Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ²ĞµÑĞ¾Ğ², Ğº ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¼Ñƒ ÑĞ¾ÑˆĞµĞ»ÑÑ Ğ¼ĞµÑ‚Ğ¾Ğ´.
print(stoch_grad_desc_weights)

#ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ Ğ½Ğ° ÑÑ€ĞµĞ´Ğ½ĞµĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ¸Ñ‡Ğ½ÑƒÑ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ½Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸.
print(stoch_errors_by_iter[-1])

#ĞšĞ°ĞºĞ¾Ğ²Ğ° ÑÑ€ĞµĞ´Ğ½ĞµĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Sales Ğ² Ğ²Ğ¸Ğ´Ğµ Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ñ 
#Ğ²ĞµÑĞ°Ğ¼Ğ¸, Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¿ÑƒÑĞºĞ°? 
answer4 = mserror(y, linear_prediction(X, stoch_grad_desc_weights))
print(answer4)
write_answer_to_file(answer4, '4.txt')